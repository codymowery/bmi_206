library(tidyverse)
install.packages('tidyverse')
##### Multiple sequence alignment
library(tidyverse)
library(msa)
## infile downloaded from https://docs.google.com/spreadsheets/d/1NJhCf--zsetVRQ5R1d5AlJH9l_SBWltjn3S8zjpTPq0/edit#gid=584681005
infile = read_csv('~/Downloads/TCR Gene Sequences - TCR Genes w_o Esp3I Sites.csv')
infile
## infile downloaded from https://docs.google.com/spreadsheets/d/1NJhCf--zsetVRQ5R1d5AlJH9l_SBWltjn3S8zjpTPq0/edit#gid=584681005
infile = read_csv('~/Downloads/TCR Gene Sequences - TCR Genes w_o Esp3I Sites.csv') %>% select(-`Esp3I Site Removed`)
infile
library(msa)
## infile downloaded from https://docs.google.com/spreadsheets/d/1NJhCf--zsetVRQ5R1d5AlJH9l_SBWltjn3S8zjpTPq0/edit#gid=584681005
infile = read_csv('~/Downloads/TCR Gene Sequences - TCR Genes w_o Esp3I Sites.csv') %>% select(-`Esp3I Site Removed`)
system.file("tex", "texshade.sty", package="msa")
## infile downloaded from https://docs.google.com/spreadsheets/d/1NJhCf--zsetVRQ5R1d5AlJH9l_SBWltjn3S8zjpTPq0/edit#gid=584681005
infile = read_csv('~/Downloads/TCR Gene Sequences - TCR Genes w_o Esp3I Sites.csv') %>% select(-`Esp3I Site Removed`) %>% rename('Gene'='gag')
## infile downloaded from https://docs.google.com/spreadsheets/d/1NJhCf--zsetVRQ5R1d5AlJH9l_SBWltjn3S8zjpTPq0/edit#gid=584681005
infile = read_csv('~/Downloads/TCR Gene Sequences - TCR Genes w_o Esp3I Sites.csv') %>% select(-`Esp3I Site Removed`) %>% rename('gag'='Gene')
trbv = DNAStringSet(infile %>% filter(grepl('TRBV', Gene)) %>% pull(Sequence))
trbv
trbv_align = msa(trbv)
msaPrettyPrint(trbv_align, output="pdf", showNames="none",
showLogo="none", askForOverwrite=FALSE, verbose=FALSE)
msaPrettyPrint(trbv_align)
system.file("tex", "texshade.sty", package="msa")
msaPrettyPrint(trbv_align)
Sys.which("pdflatex")
library(tidyverse)
nyeso = read_tsv('~/github/syntrons/vdjdb/nyeso.tsv')
mart = read_tsv('~/github/syntrons/vdjdb/mart1.tsv')
View(mart)
nyeso = read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>%
filter(complex.id != 0)
mart = read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>%
filter(complex.id != 0)
mart = read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>%
filter(complex.id != 0) ## remove TRB-only constructs
View(nyeso)
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = 'complex.i')
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = 'complex.id')
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('TRB','TRA'))
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trbv
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter('MHC A' == 'HLA-A*02:01')
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter('MHC A' == 'HLA-A*02:01')
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(MHC A == 'HLA-A*02:01')
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(`MHC A` == 'HLA-A*02:01')
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(`MHC A` == 'HLA-A*02:01')
colnames(nyeso)
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter('MHC A' == 'HLA-A*02:01')
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter('MHC A' == 'HLA-A*02:01')
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
table(nyeso$`MHC A`)
table(mart$`MHC A`)
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trav = unique(nyeso$V_TRA)
mart %>% filter(V_TRB %in% nyeso_trbv)
mart %>% filter((V_TRB %in% nyeso_trbv) & (V_TRA %in% nyeso_trav))
mart_vFilt = mart %>% filter((V_TRB %in% nyeso_trbv) & (V_TRA %in% nyeso_trav))
table(nyeso$V_TRA)
table(mart$V_TRA)
table(mart_vFilt$V_TRA)
table(nyeso$V_TRA)
mart %>% filter((V_TRB %in% nyeso_trbv) & (V_TRA %in% nyeso_trav))
mart %>% filter((V_TRB %in% nyeso_trbv)
)
mart %>% filter((V_TRB %in% nyeso_trbv) & (V_TRA %in% nyeso_trav))
mart %>% filter((V_TRA %in% nyeso_trav))
mart_vFilt = mart %>% filter((V_TRB %in% nyeso_trbv))
View(mart_vFilt)
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(!(Epitope %in% c('SLLMWITQV','ELAGIGILTV'))
)
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(!(Epitope %in% c('SLLMWITQV','ELAGIGILTV')))
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA') %>%
filter(!(Epitope %in% c('SLLMWITQV','ELAGIGILTV')))
)
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA') %>%
filter(!(Epitope %in% c('SLLMWITQV','ELAGIGILTV'))))
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA') %>%
filter(!grepl(c('SLLMWITQV','ELAGIGILTV'), Epitope)))
View(mart)
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA') %>%
filter(!grepl('SLLMWITQV', Epitope)))
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA') %>%
dplyr::filter(!grepl('SLLMWITQV', Epitope)))
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB' & !grepl('SLLMWITQV', Epitope) & !grepl('ELAGIGILTV', Epitope)),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
View(other)
all_trav = c(nyeso_trav, unique(mart_vFilt$V_TRA))
other_vFilt = other %>% filter((V_TRB %in% nyeso_trbv))
View(other_vFilt)
other_vFilt = other %>% filter((V_TRB %in% nyeso_trbv) & (V_TRA %in% all_trav))
View(other_vFilt)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
View(mart_vFilt)
all_trbv = c(nyeso_trbv, unique(mart_vFilt$V_TRB))
library(tidyverse)
nyeso = inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB' & !grepl('SLLMWITQV', Epitope) & !grepl('ELAGIGILTV', Epitope)),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trav = unique(nyeso$V_TRA)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
all_trbv = c(nyeso_trbv, unique(mart_vFilt$V_TRB))
other_vFilt = other %>% filter((V_TRB %in% all_trbv) & (V_TRA %in% nyeso_trav))
View(other_vFilt)
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
tail(5)
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
tail(.)
mart = tail(inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
View(mart)
View(nyeso)
nyeso = head(inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
mart = tail(inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB' & !grepl('SLLMWITQV', Epitope) & !grepl('ELAGIGILTV', Epitope)),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trav = unique(nyeso$V_TRA)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
all_trbv = c(nyeso_trbv, unique(mart_vFilt$V_TRB))
other_vFilt = other %>% filter((V_TRB %in% all_trbv) & (V_TRA %in% nyeso_trav))
View(other_vFilt)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
library(tidyverse)
nyeso = head(inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
mart = tail(inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB' & !grepl('SLLMWITQV', Epitope) & !grepl('ELAGIGILTV', Epitope)),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trav = unique(nyeso$V_TRA)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
View(mart_vFilt)
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(!is.na(J_TRA))
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')) %>%
filter(!is.na('J_TRA'))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA' & !is.na(V)),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
View(mart)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
View(mart_vFilt)
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA' & !is.na('V')),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA' & grepl('TRAJ',J)),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
library(tidyverse)
nyeso = head(inner_join(
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/nyeso.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA')), 5)
mart = inner_join(
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRB'),
read_tsv('~/github/syntrons/vdjdb/mart1.tsv') %>% filter(Gene=='TRA' & grepl('TRAJ',J)),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
other = inner_join(
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRB' & !grepl('SLLMWITQV', Epitope) & !grepl('ELAGIGILTV', Epitope)),
read_tsv('~/github/syntrons/vdjdb/all_A0201.tsv') %>% filter(Gene=='TRA'),
by = c('complex.id','MHC A','Epitope'), suffix=c('_TRB','_TRA'))
nyeso_trbv = unique(nyeso$V_TRB)
nyeso_trav = unique(nyeso$V_TRA)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav))
View(mart_vFilt)
length(CASSWGGLSNQPQHF)
length('CASSWGGLSNQPQHF')
nchar('CASSWGGLSNQPQHF')
all_trbv = c(nyeso_trbv, unique(mart_vFilt$V_TRB))
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav) &
(nchar(CDR3_TRA < 20)))
nchar('CAARVDMYSGGGADGLTF')
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav) &
(nchar(CDR3_TRA <= 15)))
nchar('CAARVDMYSGGGADGLTF')
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav) &&
(nchar(CDR3_TRA <= 15)))
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav) &
(nchar(CDR3_TRA <= 15)))
mart_vFilt = mart %>% filter((nchar(CDR3_TRA <= 15)) & (V_TRA %in% nyeso_trav))
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(V_TRA) %>% head(.,1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by('V_TRA') %>% head(.,1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
top_n(V_TRA, n=1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by_(~ V_TRA) %>%
slice(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(~ V_TRA) %>%
slice(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(V_TRA) %>%
slice(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(V_TRA) %>%
top_n(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(V_TRA) %>%
top_n(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by('J_TRA') %>%
top_n(1)
mart_vFilt = mart %>% filter((V_TRA %in% nyeso_trav)) %>%
group_by(J_TRA) %>%
slice(1)
all_trbv = c(nyeso_trbv, unique(mart_vFilt$V_TRB))
other_vFilt = other %>% filter((V_TRB %in% all_trbv) & (V_TRA %in% nyeso_trav))
unique(nyeso$V_TRB)
unique(mart_vFilt$V_TRB)
unique(nyeso$V_TRA)
unique(mart_vFilt$V_TRA)
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv))
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv)) %>%
group_by(J_TRA) %>%
slice(1)
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv)) %>%
group_by(J_TRA) %>% slice(1) %>% ungroup() %>%
group_by(V_TRA) %>% slice(1) %>% ungroup()
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv)) %>%
group_by(J_TRA) %>% slice(1) %>% ungroup() %>%
group_by(V_TRB) %>% slice(1) %>% ungroup()
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv)) %>%
group_by(J_TRA) %>% slice(1) %>% ungroup() %>%
group_by(V_TRB, V_TRA) %>% slice(1) %>% ungroup()
other_vFilt = other %>% filter((V_TRA %in% nyeso_trav) &
(V_TRB %in% all_trbv)) %>%
group_by(J_TRA) %>% slice(1) %>% ungroup() %>%
group_by(V_TRB) %>% slice(1) %>% ungroup() %>%
head(5)
nchar(CAYRSARASGAGSYQLTF)
nchar('CAYRSARASGAGSYQLTF')
v1 = bind_rows(nyeso, mart_vFilt, other_vFilt)
View(v1)
colnames(nyeso)
v1 = bind_rows(nyeso, mart_vFilt, other_vFilt) %>%
select("CDR3_TRB","V_TRB","J_TRB","MHC A","CDR3_TRA","V_TRA","J_TRA","Epitope")
v1 = bind_rows(nyeso, mart_vFilt, other_vFilt) %>%
select("Epitope gene_TRB","Epitope","MHC A","CDR3_TRB","V_TRB","J_TRB","CDR3_TRA","V_TRA","J_TRA")
length(unique(v1$V_TRA))
length(unique(v1$V_TRB)) # 5 constructs
write_csv(v1, '~/github/syntrons/vdjdb/filteredTCRlist_v1.csv')
length(unique(v1$V_TRA)) # 5 constructs
length(unique(v1$V_TRB)) # 9 constructs
head = head(infile, 10e3)
library(tidyverse)
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds')
head = head(infile, 10e3)
## ID introns with homopolymers >= 3 bases
homoPs = grep('[A]{3}|[G]{3}|[C]{3}|[T]{3}', head)
homoPs
head
## ID introns with homopolymers >= 3 bases
homoPs = grep('[A]{3}|[G]{3}|[C]{3}|[T]{3}', head$intron)
homoPs
head[!homoPs,]
head[!grep('[A]{3}|[G]{3}|[C]{3}|[T]{3}', head$intron),]
head[!grepl('[A]{3}|[G]{3}|[C]{3}|[T]{3}', head$intron),]
sub = infile %>% group_by(sample) %>% slice(1e6)
View(sub)
sub = infile %>% group_by(sample) %>% slice(1000000)
View(sub)
sub = infile %>% group_by(sample) %>% slice(1:1000000)
View(sub)
## ID introns with homopolymers >= 3 bases
homoPs = grepl('[A]{3}|[G]{3}|[C]{3}|[T]{3}', sub$intron)
homoPs
head[!homoPs,]
table(homoPs)
homoPs
!homoPs
## Filter to non-homopolymer introns
sub[!homoPs,]
## Filter to non-homopolymer introns
filt = sub[!homoPs,]
table(filt$sample,filt$intron)
table(filt$sample)
filt
dim(filt)
dim(filt$intron)
length(filt$intron)
length(unique(filt$intron))
## ID introns with homopolymers >= 3 bases
homoPs = grepl('[N]{1}|[A]{3}|[G]{3}|[C]{3}|[T]{3}', sub$intron)
table(homoPs)
## Filter to non-homopolymer introns
filt = sub[!homoPs,]
table(filt$sample)
length(filt$intron)
length(unique(filt$intron))
## Filter to non-homopolymer introns
filt = unique(sub[!homoPs,])
table(filt$sample)
length(filt$intron)
length(unique(filt$intron))
filt
overhangs = read_csv('~/github/syntrons/gene_sequences/overhangSets_HamediRadEtAl2019.csv')
colnames(overhangs) = overhangs[1,]
overhangs = overhangs[2:nrow(overhangs),1:6]
fifty = overhangs %>% filter(Size==50) %>% pull(`Set 1`)
fifty = str_split(fifty,',')
fifty
fifty
unlist(fifty)
fifty = unlist(str_split(fifty,','))
fifty
fifty = overhangs %>% filter(Size==50) %>% pull(`Set 1`)
fifty = unlist(str_split(fifty,','))
fifty
library(Biostrings)
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
fivep = substr(intron, start = width(intron)-21, stop = width(intron)-17))
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
threep = substr(intron, start = width(intron)-21, stop = width(intron)-17))
infile
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
threep = substr(intron, start = width(intron)-20, stop = width(intron)-17))
infile
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
threep = substr(intron, start = width(intron)-20, stop = width(intron)-17)) %>%
filter((fivep %in% fifty)|(threep %in% fifty))
infile
fifty
which('CTCC',fifty)
in('CTCC',fifty)
'CTCC' %in% fifty
grep('CTCC',fifty)
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
fivep_in = fivep %in% fifty,
threep = substr(intron, start = width(intron)-20, stop = width(intron)-17),
threep_in = threep %in% fifty)
infile
## read in introns
infile = read_rds('~/Box/Projects/syntrons/201006-2/201006-2_posSplitReads_fixed.rds') %>%
mutate(fivep = substr(intron, start = 6, stop = 9),
fivep_in = fivep %in% fifty,
threep = substr(intron, start = width(intron)-20, stop = width(intron)-17),
threep_in = threep %in% fifty) %>%
filter((fivep_in==TRUE) | (threep_in==TRUE))
infile
## ID introns with homopolymers >= 3 bases
homoPs = grepl('[N]{1}|[A]{3}|[G]{3}|[C]{3}|[T]{3}', infile$intron)
table(homoPs)
## Filter to non-homopolymer introns
filt = unique(sub[!homoPs,])
## Filter to non-homopolymer introns
filt = unique(infile[!homoPs,])
table(filt$sample)
length(filt$intron)
length(unique(filt$intron))
filt
table(filt$sample, filt$fivep_in)
table(filt$sample, filt$fivep_in, filt$threep_in)
table(filt$fivep_in, filt$threep_in)
length(filt$intron)
length(unique(filt$intron))
filt
adist((filt %>% filter(fivep==TRUE & threep==TRUE))$intron)
filt %>% filter(fivep==TRUE & threep==TRUE)
adist((filt %>% filter(fivep_in==TRUE & threep_in==TRUE))$intron)
heatmap(adist((filt %>% filter(fivep_in==TRUE & threep_in==TRUE))$intron))
write_rds(filt, '~/Box/Projects/syntrons/201006-2/201006-2_pos_filtHomoPs_filtOverhangs.rds')
library(tidyverse)
library(Biostrings)
#load packages
library(regioneR)
set.seed(10)
setwd('~/github/bmi_206/lab3/')
#read in BED formatted region files: all tested regions and two sets of positives
# these are in hg19 human genome assembly coordinates
all=toGRanges(read.table("all.bed",sep="\t"))
hits1=toGRanges(read.table("hits1.bed",sep="\t"))
hits2=toGRanges(read.table("hits2.bed",sep="\t"))
overlapGraphicalSummary(hits1, all, regions.labels=c('hits1', 'all'))
